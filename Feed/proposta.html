<!DOCTYPE html>
<html lang="pt-br">
  <head>
    <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Propostas</title>

  <link rel="stylesheet" href="../Home/style.css">
  <link rel="shortcut icon" href="../assets/logo.png" type="image/x-icon">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css">
  <link rel="stylesheet" href="../Home/home.css">
  <script src="../js/logout.js"></script>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">

    <title>Enviar Proposta</title>
    <style>
      body {
        font-family: Arial, sans-serif;
        background-color: #f4f4f4;
        color: #fff;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        height: 100vh;
        margin: 0;
      }

      .header-content {
        display: flex;
        justify-content: space-between;
        align-items: center;
        width: 400px;
        margin-bottom: 20px;
      }

      .back-button {
        font-size: 24px;
        color: #2c1e4a;
        background: none;
        border: none;
        cursor: pointer;
      }

      .logo-header {
        width: 100px; /* Ajuste o tamanho conforme necessário */
        height: auto;
      }

      .container {
        background-color: #2c1e4a; /* Roxo escuro */
        padding: 20px;
        width: 400px;
        border-radius: 8px;
        box-shadow: 0px 4px 8px rgba(0, 0, 0, 0.1);
        text-align: center;
      }

      .container h2 {
        color: #ffffff;
        margin-bottom: 20px;
      }

      label {
        color: #a8a3c5; /* Texto roxo claro */
        font-size: 14px;
        display: block;
        margin-bottom: 8px;
        text-align: left;
      }

      input[type="text"],
      input[type="number"],
      textarea {
        width: 90%;
        padding: 10px;
        border: 1px solid #443362;
        background-color: #3b2a5e;
        color: #ffffff;
        border-radius: 5px;
        margin-bottom: 15px;
        font-size: 14px;
      }

      .alert {
        color: #f36c6c;
        font-size: 12px;
        margin-bottom: 15px;
      }

      .btn-submit {
        background-color: #28a745; /* Verde */
        color: #ffffff;
        border: none;
        padding: 10px 20px;
        font-size: 16px;
        font-weight: bold;
        border-radius: 5px;
        cursor: pointer;
        width: 100%;
      }

      .btn-submit:hover {
        background-color: #218838;
      }

      .link {
        color: #a8a3c5;
        text-decoration: underline;
        font-size: 12px;
      }
    </style>
  </head>
  <body>
    <header class="header-content">
      <button class="back-button" onclick="window.history.back()">←</button>
      <a href="../Home/index.html">
        <img src="../assets/logo.png" alt="Logo do site" class="logo-header" />
      </a>
    </header>

    <main>
      <div class="container">
        <h2>Enviar Proposta</h2>
        <form onsubmit="EnviarProposta(); return false;">
          <label for="oferta">Selecione sua oferta</label>
          <select id="oferta" name="oferta" required>
            <option value="" disabled selected>Escolha uma oferta</option>
            <option value="60">R$ 60,00 por diária</option>
            <option value="80">R$ 80,00 por diária</option>
            <option value="100">R$ 100,00 por diária</option>
            <option value="120">R$ 120,00 por diária</option>
            <option value="130">R$ 130,00 por diária</option>
            <option value="140">R$ 140,00 por diária</option>
            <option value="160">R$ 160,00 por diária</option>
            <option value="180">R$ 180,00 por diária</option>
            <option value="190">R$ 200,00 por diária</option>
            <option value="190">R$ 210,00 por diária</option>
            <option value="190">R$ 220,00 por diária</option>
            <option value="10">R$ 230,00 por diária</option>
            <option value="240">R$ 240,00 por diária</option>
          </select>

          <label for="detalhes">Detalhes</label>
          <textarea
            id="detalhes"
            name="detalhes"
            rows="4"
            placeholder="Escreva aqui os detalhes da proposta , como é calculado o custo?"
            required
          ></textarea>

          <label for="duracao">Duração estimada</label>
          <input
            type="number"
            id="duracao"
            name="duracao"
            placeholder="Dias"
            required
          />

          <div class="alert">
            ⚠ Atenção: não compartilhe suas informações de contato.
          </div>
          <p id="responseMessage"></p>
          <button type="submit" class="btn-submit">Enviar proposta</button>
        </form>
      </div>
    </main>
  </body>
</html>
<script>
  window.onload = function () {
    // Verifique o localStorage imediatamente após o carregamento da página
    const userName = localStorage.getItem('userName');
    const token = localStorage.getItem('token');
    if (token && userName) {
      // Se os dados estiverem presentes, exiba o nome do usuário
    } else {
      console.error("Dados não encontrados no localStorage");
      //  window.location.href = '../home/index.html'; // Redireciona para a página de login se os dados não estiverem presentes
    }
  };

  //obter valores para envio

  async function EnviarProposta() {
 
  
    // Obtenha os valores do formulário
    const id_vaga = localStorage.getItem("IdVaga");
    const oferta = document.getElementById("oferta").value;
    const id_Freelancer = localStorage.getItem("userid");

    console.log("Id da vaga que esta sendo selecionada: " + id_vaga);
    console.log("IdFreelancerq que esta logado: " + id_Freelancer);
    const detalhes = document.getElementById("detalhes").value;
    const duracao = document.getElementById("duracao").value;
    const response = await fetch(
      "http://localhost:3000/propostas/registerProposta",
      {
        method: "POST",
        headers: {
          "Content-Type": "application/json",
          //authorization: token,
        },
        body: JSON.stringify({
          oferta,
          detalhes,
          duracao,
          id_vaga,
          id_Freelancer,
        }),
      }
    );

    const result = await response.json();

    const responseMessage = document.getElementById("responseMessage");
    if (result.msg === "Oferta Enviada com sucesso!") {
      responseMessage.style.color = "green";
      responseMessage.innerText = result.msg;
  
    } else {
      responseMessage.innerText = result.msg;
      responseMessage.style.color = "red";
    }
  }
</script>
<script src="https://code.jquery.com/jquery-3.6.4.min.js"></script>
